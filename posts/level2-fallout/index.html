<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Level 2 - Fallout | Ardias</title>
<meta name="keywords" content="Ethernaut">
<meta name="description" content="Haloo kita lanjutkan kembali series ethernaut ini di Level 2 yaitu Fallout, Lesgo!
Pada level kali ini kita diberikan source code dari smart contractnya sebagai berikut
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import &#39;openzeppelin-contracts-06/math/SafeMath.sol&#39;; contract Fallout { using SafeMath for uint256; mapping (address =&gt; uint) allocations; address payable public owner; /* constructor */ function Fal1out() public payable { owner = msg.sender; allocations[owner] = msg.value; } modifier onlyOwner { require( msg.sender == owner, &#34;caller is not the owner&#34; ); _; } function allocate() public payable { allocations[msg.">
<meta name="author" content="Ardias">
<link rel="canonical" href="https://agilfchx.github.io/posts/level2-fallout/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css" integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U&#43;6hYRq/Ez/nm5vg=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://agilfchx.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://agilfchx.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://agilfchx.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://agilfchx.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://agilfchx.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Level 2 - Fallout" />
<meta property="og:description" content="Haloo kita lanjutkan kembali series ethernaut ini di Level 2 yaitu Fallout, Lesgo!
Pada level kali ini kita diberikan source code dari smart contractnya sebagai berikut
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import &#39;openzeppelin-contracts-06/math/SafeMath.sol&#39;; contract Fallout { using SafeMath for uint256; mapping (address =&gt; uint) allocations; address payable public owner; /* constructor */ function Fal1out() public payable { owner = msg.sender; allocations[owner] = msg.value; } modifier onlyOwner { require( msg.sender == owner, &#34;caller is not the owner&#34; ); _; } function allocate() public payable { allocations[msg." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://agilfchx.github.io/posts/level2-fallout/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-25T22:22:43+07:00" />
<meta property="article:modified_time" content="2023-08-25T22:22:43+07:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Level 2 - Fallout"/>
<meta name="twitter:description" content="Haloo kita lanjutkan kembali series ethernaut ini di Level 2 yaitu Fallout, Lesgo!
Pada level kali ini kita diberikan source code dari smart contractnya sebagai berikut
// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import &#39;openzeppelin-contracts-06/math/SafeMath.sol&#39;; contract Fallout { using SafeMath for uint256; mapping (address =&gt; uint) allocations; address payable public owner; /* constructor */ function Fal1out() public payable { owner = msg.sender; allocations[owner] = msg.value; } modifier onlyOwner { require( msg.sender == owner, &#34;caller is not the owner&#34; ); _; } function allocate() public payable { allocations[msg."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://agilfchx.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Level 2 - Fallout",
      "item": "https://agilfchx.github.io/posts/level2-fallout/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Level 2 - Fallout",
  "name": "Level 2 - Fallout",
  "description": "Haloo kita lanjutkan kembali series ethernaut ini di Level 2 yaitu Fallout, Lesgo!\nPada level kali ini kita diberikan source code dari smart contractnya sebagai berikut\n// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import \u0026#39;openzeppelin-contracts-06/math/SafeMath.sol\u0026#39;; contract Fallout { using SafeMath for uint256; mapping (address =\u0026gt; uint) allocations; address payable public owner; /* constructor */ function Fal1out() public payable { owner = msg.sender; allocations[owner] = msg.value; } modifier onlyOwner { require( msg.sender == owner, \u0026#34;caller is not the owner\u0026#34; ); _; } function allocate() public payable { allocations[msg.",
  "keywords": [
    "Ethernaut"
  ],
  "articleBody": "Haloo kita lanjutkan kembali series ethernaut ini di Level 2 yaitu Fallout, Lesgo!\nPada level kali ini kita diberikan source code dari smart contractnya sebagai berikut\n// SPDX-License-Identifier: MIT pragma solidity ^0.6.0; import 'openzeppelin-contracts-06/math/SafeMath.sol'; contract Fallout { using SafeMath for uint256; mapping (address =\u003e uint) allocations; address payable public owner; /* constructor */ function Fal1out() public payable { owner = msg.sender; allocations[owner] = msg.value; } modifier onlyOwner { require( msg.sender == owner, \"caller is not the owner\" ); _; } function allocate() public payable { allocations[msg.sender] = allocations[msg.sender].add(msg.value); } function sendAllocation(address payable allocator) public { require(allocations[allocator] \u003e 0); allocator.transfer(allocations[allocator]); } function collectAllocations() public onlyOwner { msg.sender.transfer(address(this).balance); } function allocatorBalance(address allocator) public view returns (uint) { return allocations[allocator]; } } Goals : player harus claim ownership contract tersebut\nBreakdown the code Oke mari kita breakdown smart contract yang bisa kita exploit\npragma solidity ^0.6.0; **(1)** import 'openzeppelin-contracts-06/math/SafeMath.sol'; **(2)** contract Fallout { using SafeMath for uint256; **(3)** mapping (address =\u003e uint) allocations; **(4)** address payable public owner; **(5)** /* constructor */ function Fal1out() public payable { **(6)** owner = msg.sender; allocations[owner] = msg.value; } \u003csnip\u003e Smart contract ini menggunakan compiler solidity v0.6.0 ke atas Melakukan import library SafeMath.sol Deklarasi penggunaan SafeMath dengan tipe data uint256 Deklarasi variable allocations bertipe data mapping yang akan menyimpan alokasi uint Deklarasi variable owner yang bertipe data address dan payable sehingga address ini dapat mengirim dan menerima ether. Constructor dari contract Fallout yang akan menassign msg.sender menjadi owner Explainoit (Explain \u0026 Exploit) Baik setelah kita memahami code yang sudah dijelaskan secara singkat diatas, jika kita perhatikan yang menarik perhatian pertama kali adalah constructornya berbeda dengan smart contract sebelumnya. Kenapa bisa?\nJadi constructor pada Solidity v0.4.21 kebawah mempunyai sebuah constructor seperti berikut\npragma solidity ^0.4.11; contract A { uint public a; function A(uint _a) internal { a = _a; } } Jika kita perhatikan constructornya itu akan memanggil nama contractnya, sedangkan di versi 0.4.22 ke atas constructornya seperti yang kita sudah tahu sebelumnya\nconstructor(){ owner = msg.sender; } Nah pada smart contract ini menggunakan Solidity v0.6.0 yang sangat aneh jika constructornya seperti source code yang dikasih. Tetapi jika kalian lihat nama constructornya pada source code ini sedikit aneh karena penamaan Fallout nya itu salah satu hurufnya menggunakan angka 1 sehingga menjadi Fal1out\nDan jika kita coba ubah nama constructornya menjadi Fallout sama seperti nama contract akan terdapat error seperti berikut\nNot allowed same as contract Ini menandakan bahwa v0.4.22 ke atas tidak bisa memiliki nama function yang sama seperti nama contract. Jika kita coba jalankan perintah berikut\nawait contract.owner(); Ternyata ownernya tidak di define, ini karena Fal1out ini merupakan sebuah public function sehingga tidak ada constructor yang berjalan\nFallout Contract Owner Oleh karena itu kita bisa akses function Fallout() langsung untuk mengubah ownershipnya dengan menjalankan perintah berikut\nawait contract.Fal1out(); Change Owner Dan kita cek kembali ownernya dengan menjalankan perintah yang sama\nawait contract.owner(); Ownernya sudah berubah menjadi address kita/player\nOwner changed Level ini memiliki SWC-118: Incorrect Constructor Name dan level ini juga mempunyai case real world pada perusahaan yang bernama Dynamic Pyramid berubah nama menjadi Rubixi , tetapi mereka lupa untuk mengubah nama constructor methodnya seperti berikut\ncontract Rubixi { address private owner; function DynamicPyramid() { owner = msg.sender; } function collectAllFees() { owner.transfer(this.balance) } ... Sehingga attacker dapat memanggil old constructor untuk claim ownership contractnya\nOkey segitu saja untuk post kali ini, kita akan bertemu lagi di level berikutnya\nSeeya üëãüê¢\n",
  "wordCount" : "564",
  "inLanguage": "en",
  "datePublished": "2023-08-25T22:22:43+07:00",
  "dateModified": "2023-08-25T22:22:43+07:00",
  "author":{
    "@type": "Person",
    "name": "Ardias"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://agilfchx.github.io/posts/level2-fallout/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Ardias",
    "logo": {
      "@type": "ImageObject",
      "url": "https://agilfchx.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://agilfchx.github.io/" accesskey="h" title="Ardias (Alt + H)">
                <img src="https://agilfchx.github.io/logo.png" alt="" aria-label="logo"
                    height="35">Ardias</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://agilfchx.github.io/posts" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://agilfchx.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://agilfchx.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://agilfchx.github.io/">Home</a>&nbsp;¬ª&nbsp;<a href="https://agilfchx.github.io/posts/">Posts</a></div>
    <h1 class="post-title">
      Level 2 - Fallout
    </h1>
    <div class="post-meta"><span title='2023-08-25 22:22:43 +0700 +0700'>August 25, 2023</span>&nbsp;¬∑&nbsp;3 min&nbsp;¬∑&nbsp;Ardias

</div>
  </header> 
  <div class="post-content"><p>Haloo kita lanjutkan kembali series ethernaut ini di Level 2 yaitu Fallout, Lesgo!</p>
<p>Pada level kali ini kita diberikan source code dari smart contractnya sebagai berikut</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#75715e">// SPDX-License-Identifier: MIT
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">pragma solidity</span> <span style="color:#f92672">^</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">6</span>.<span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#39;openzeppelin-contracts-06/math/SafeMath.sol&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">Fallout</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">using</span> SafeMath <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">uint256</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">mapping</span> (<span style="color:#66d9ef">address</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint</span>) allocations;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">payable</span> <span style="color:#66d9ef">public</span> owner;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/* constructor */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Fal1out</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">payable</span> {
</span></span><span style="display:flex;"><span>    owner <span style="color:#f92672">=</span> msg.sender;
</span></span><span style="display:flex;"><span>    allocations[owner] <span style="color:#f92672">=</span> msg.value;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">modifier</span> <span style="color:#a6e22e">onlyOwner</span> {
</span></span><span style="display:flex;"><span>	        require(
</span></span><span style="display:flex;"><span>	            msg.sender <span style="color:#f92672">==</span> owner,
</span></span><span style="display:flex;"><span>	            <span style="color:#e6db74">&#34;caller is not the owner&#34;</span>
</span></span><span style="display:flex;"><span>	        );
</span></span><span style="display:flex;"><span>	        <span style="color:#66d9ef">_</span>;
</span></span><span style="display:flex;"><span>	    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">allocate</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">payable</span> {
</span></span><span style="display:flex;"><span>    allocations[msg.sender] <span style="color:#f92672">=</span> allocations[msg.sender].add(msg.value);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sendAllocation</span>(<span style="color:#66d9ef">address</span> <span style="color:#66d9ef">payable</span> allocator) <span style="color:#66d9ef">public</span> {
</span></span><span style="display:flex;"><span>    require(allocations[allocator] <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>);
</span></span><span style="display:flex;"><span>    allocator.transfer(allocations[allocator]);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">collectAllocations</span>() <span style="color:#66d9ef">public</span> onlyOwner {
</span></span><span style="display:flex;"><span>    msg.sender.transfer(<span style="color:#66d9ef">address</span>(this).balance);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">allocatorBalance</span>(<span style="color:#66d9ef">address</span> allocator) <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">view</span> <span style="color:#66d9ef">returns</span> (<span style="color:#66d9ef">uint</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> allocations[allocator];
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>Goals : <code>player</code> harus claim <code>ownership</code> contract tersebut</p>
</blockquote>
<h3 id="breakdown-the-code">Breakdown the code<a hidden class="anchor" aria-hidden="true" href="#breakdown-the-code">#</a></h3>
<p>Oke mari kita breakdown smart contract yang bisa kita exploit</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#66d9ef">pragma solidity</span> <span style="color:#f92672">^</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">6</span>.<span style="color:#ae81ff">0</span>; <span style="color:#f92672">**</span>(<span style="color:#ae81ff">1</span>)<span style="color:#f92672">**</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#e6db74">&#39;openzeppelin-contracts-06/math/SafeMath.sol&#39;</span>; <span style="color:#f92672">**</span>(<span style="color:#ae81ff">2</span>)<span style="color:#f92672">**</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">Fallout</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">using</span> SafeMath <span style="color:#66d9ef">for</span> <span style="color:#66d9ef">uint256</span>; <span style="color:#f92672">**</span>(<span style="color:#ae81ff">3</span>)<span style="color:#f92672">**</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">mapping</span> (<span style="color:#66d9ef">address</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">uint</span>) allocations; <span style="color:#f92672">**</span>(<span style="color:#ae81ff">4</span>)<span style="color:#f92672">**</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">payable</span> <span style="color:#66d9ef">public</span> owner; <span style="color:#f92672">**</span>(<span style="color:#ae81ff">5</span>)<span style="color:#f92672">**</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">/* constructor */</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">Fal1out</span>() <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">payable</span> { <span style="color:#f92672">**</span>(<span style="color:#ae81ff">6</span>)<span style="color:#f92672">**</span>
</span></span><span style="display:flex;"><span>    owner <span style="color:#f92672">=</span> msg.sender;
</span></span><span style="display:flex;"><span>    allocations[owner] <span style="color:#f92672">=</span> msg.value;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span>snip<span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><ol>
<li>Smart contract ini menggunakan compiler solidity v0.6.0 ke atas</li>
<li>Melakukan import library <code>SafeMath.sol</code></li>
<li>Deklarasi penggunaan <code>SafeMath</code> dengan tipe data uint256</li>
<li>Deklarasi variable <code>allocations</code> bertipe data mapping yang akan menyimpan alokasi uint</li>
<li>Deklarasi variable <code>owner</code> yang bertipe data <code>address</code> dan <code>payable</code> sehingga address ini dapat mengirim dan menerima ether.</li>
<li>Constructor dari contract <code>Fallout</code> yang akan menassign <code>msg.sender</code> menjadi <code>owner</code></li>
</ol>
<h3 id="explainoit-explain--exploit">Explainoit (Explain &amp; Exploit)<a hidden class="anchor" aria-hidden="true" href="#explainoit-explain--exploit">#</a></h3>
<p>Baik setelah kita memahami code yang sudah dijelaskan secara singkat diatas, jika kita perhatikan yang menarik perhatian pertama kali adalah <code>constructor</code>nya berbeda dengan smart contract sebelumnya. Kenapa bisa?</p>
<p>Jadi constructor pada <a href="https://docs.soliditylang.org/en/v0.4.21/contracts.html">Solidity v0.4.21</a> kebawah mempunyai sebuah constructor seperti berikut</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#66d9ef">pragma solidity</span> <span style="color:#f92672">^</span><span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">4</span>.<span style="color:#ae81ff">11</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">A</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">uint</span> <span style="color:#66d9ef">public</span> a;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">A</span>(<span style="color:#66d9ef">uint</span> _a) <span style="color:#66d9ef">internal</span> {
</span></span><span style="display:flex;"><span>        a <span style="color:#f92672">=</span> _a;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Jika kita perhatikan constructornya itu akan memanggil nama contractnya, sedangkan di versi 0.4.22 ke atas constructornya seperti yang kita sudah tahu sebelumnya</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#66d9ef">constructor</span>(){
</span></span><span style="display:flex;"><span>	owner <span style="color:#f92672">=</span> msg.sender;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Nah pada smart contract ini menggunakan Solidity v0.6.0 yang sangat aneh jika constructornya seperti source code yang dikasih. Tetapi jika kalian lihat nama constructornya pada source code ini sedikit aneh karena penamaan <code>Fallout</code> nya itu salah satu hurufnya menggunakan angka <code>1</code> sehingga menjadi <code>Fal1out</code></p>
<p>Dan jika kita coba ubah nama constructornya menjadi <code>Fallout</code> sama seperti nama contract akan terdapat error seperti berikut</p>
<figure class="align-center ">
    <img loading="lazy" src="/images/20230825/notAllowed.png#center"/> <figcaption>
            Not allowed same as contract
        </figcaption>
</figure>

<p>Ini menandakan bahwa v0.4.22 ke atas tidak bisa memiliki nama <em>function</em> yang sama seperti nama contract. Jika kita coba jalankan perintah berikut</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">contract</span>.<span style="color:#a6e22e">owner</span>();
</span></span></code></pre></div><p>Ternyata ownernya tidak di define, ini karena <code>Fal1out</code> ini merupakan sebuah public function sehingga tidak ada constructor yang berjalan</p>
<figure class="align-center ">
    <img loading="lazy" src="/images/20230825/contractowner.png#center"/> <figcaption>
            Fallout Contract Owner
        </figcaption>
</figure>

<p>Oleh karena itu kita bisa akses function <code>Fallout()</code> langsung untuk mengubah ownershipnya dengan menjalankan perintah berikut</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">contract</span>.<span style="color:#a6e22e">Fal1out</span>();
</span></span></code></pre></div><figure class="align-center ">
    <img loading="lazy" src="/images/20230825/changeowner.png#center"/> <figcaption>
            Change Owner
        </figcaption>
</figure>

<p>Dan kita cek kembali ownernya dengan menjalankan perintah yang sama</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-jsx" data-lang="jsx"><span style="display:flex;"><span><span style="color:#66d9ef">await</span> <span style="color:#a6e22e">contract</span>.<span style="color:#a6e22e">owner</span>();
</span></span></code></pre></div><p>Ownernya sudah berubah menjadi address kita/<code>player</code></p>
<figure class="align-center ">
    <img loading="lazy" src="/images/20230825/changed.png#center"/> <figcaption>
            Owner changed
        </figcaption>
</figure>

<p>Level ini memiliki <a href="https://swcregistry.io/docs/SWC-118/">SWC-118: Incorrect Constructor Name</a> dan level ini juga mempunyai case real world pada perusahaan yang bernama <code>Dynamic Pyramid</code> berubah nama menjadi <code>Rubixi</code> , tetapi mereka lupa untuk mengubah nama constructor methodnya seperti berikut</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-solidity" data-lang="solidity"><span style="display:flex;"><span><span style="color:#66d9ef">contract</span> <span style="color:#a6e22e">Rubixi</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">address</span> <span style="color:#66d9ef">private</span> owner;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">DynamicPyramid</span>() { owner <span style="color:#f92672">=</span> msg.sender; }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">collectAllFees</span>() { owner.transfer(this.balance) }
</span></span><span style="display:flex;"><span>  ...
</span></span></code></pre></div><p>Sehingga attacker dapat memanggil old constructor untuk claim ownership contractnya</p>
<p>Okey segitu saja untuk post kali ini, kita akan bertemu lagi di level berikutnya</p>
<p>Seeya üëãüê¢</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://agilfchx.github.io/tags/ethernaut/">Ethernaut</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://agilfchx.github.io/">Ardias</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
